kind: Dashboard
metadata:
  name: nodeexportersimple
  createdAt: "0001-01-01T00:00:00Z"
  updatedAt: "0001-01-01T00:00:00Z"
  version: 0
  project: athebaud
spec:
  variables:
    - kind: TextVariable
      spec:
        name: stack
        value: erd4
        constant: true
    - kind: TextVariable
      spec:
        name: prometheus
        value: system
        constant: true
    - kind: TextVariable
      spec:
        name: job
        value: cmdbrtu-custom-sd
        constant: true
    - kind: ListVariable
      spec:
        name: instance
        display:
          name: Host
          hidden: false
        allowAllValue: false
        allowMultiple: false
        plugin:
          kind: PrometheusPromQLVariable
          spec:
            datasource:
              kind: PrometheusDatasource
              name: argos-world
            expr: group by (instance) (node_uname_info{stack="$stack",prometheus="$prometheus",job="$job"})
            labelName: instance
  panels:
    "0_0":
      kind: Panel
      spec:
        display:
          name: Sys Load (5m avg)
          description: Busy state of all CPU cores together (5 min average)
        plugin:
          kind: GaugeChart
          spec:
            calculation: last-number
            format:
              unit: percent
            thresholds:
              steps:
                - color: rgba(50, 172, 45, 0.97)
                  value: 0
                - color: rgba(237, 129, 40, 0.89)
                  value: 80
                - color: rgba(245, 54, 54, 0.9)
                  value: 90
            max: 100
        queries:
          - kind: TimeSeriesQuery
            spec:
              plugin:
                kind: PrometheusTimeSeriesQuery
                spec:
                  datasource:
                    kind: PrometheusDatasource
                    name: argos-world
                  query: |-
                    avg_over_time(node_load5{stack="$stack",prometheus="$prometheus",job="$job",instance="$instance"}[$__rate_interval]) * 100
                    /
                    on(instance) group_left sum by (instance) (
                        irate(node_cpu_seconds_total{stack="$stack",prometheus="$prometheus",job="$job",instance="$instance"}[$__rate_interval])
                    )
    "0_1":
      kind: Panel
      spec:
        display:
          name: RAM Used
          description: Non available RAM memory
        plugin:
          kind: GaugeChart
          spec:
            calculation: last-number
            format:
              unit: percent
            thresholds:
              steps:
                - color: rgba(50, 172, 45, 0.97)
                  value: 0
                - color: rgba(237, 129, 40, 0.89)
                  value: 80
                - color: rgba(245, 54, 54, 0.9)
                  value: 90
            max: 100
        queries:
          - kind: TimeSeriesQuery
            spec:
              plugin:
                kind: PrometheusTimeSeriesQuery
                spec:
                  datasource:
                    kind: PrometheusDatasource
                    name: argos-world
                  query: |-
                    (
                        (
                            avg_over_time(node_memory_MemTotal_bytes{stack="$stack",prometheus="$prometheus",job="$job",instance="$instance"}[$__rate_interval])
                            -
                            avg_over_time(node_memory_MemFree_bytes{stack="$stack",prometheus="$prometheus",job="$job",instance="$instance"}[$__rate_interval])
                        )
                        /
                        (
                            avg_over_time(node_memory_MemTotal_bytes{stack="$stack",prometheus="$prometheus",job="$job",instance="$instance"}[$__rate_interval])
                        )
                    ) * 100
          - kind: TimeSeriesQuery
            spec:
              plugin:
                kind: PrometheusTimeSeriesQuery
                spec:
                  datasource:
                    kind: PrometheusDatasource
                    name: argos-world
                  query: "100 - (\n    (\n        avg_over_time(node_memory_MemAvailable_bytes{stack=\"$stack\",prometheus=\"$prometheus\",job=\"$job\",instance=\"$instance\"}[$__rate_interval])\n        *\n        100\n    ) \n    /\n    avg_over_time(node_memory_MemTotal_bytes{stack=\"$stack\",prometheus=\"$prometheus\",job=\"$job\",instance=\"$instance\"}[$__rate_interval])\n)"
  layouts:
    - kind: Grid
      spec:
        display:
          title: Quick CPU / Mem / Disk
        items:
          - x: 0
            "y": 0
            width: 3
            height: 6
            content:
              $ref: '#/spec/panels/0_0'
          - x: 3
            "y": 0
            width: 3
            height: 6
            content:
              $ref: '#/spec/panels/0_1'
    - kind: Grid
      spec:
        display:
          title: Basic CPU / Mem / Net / Disk
        items: []
  duration: 1h
